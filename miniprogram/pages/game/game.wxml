<!--pages/game/game.wxml-->
<view class="game-container">
  <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
  <view class="game-header">
    <view class="room-info">
      <text class="room-code">æˆ¿é—´: {{roomCode}}</text>
    </view>
    <view class="timer" wx:if="{{gameState === 'SOLVING'}}">
      <text class="timer-text">{{countdown}}s</text>
    </view>
  </view>

  <!-- å¯¹æ‰‹ä¿¡æ¯ -->
  <view class="opponent-section">
    <view class="player-info">
      <text class="player-name">{{opponent.name || 'å¯¹æ‰‹'}}</text>
      <view class="card-count">
        <text class="card-emoji">â¤ï¸</text>
        <text class="card-number">{{opponent.cardCount || 10}}</text>
      </view>
    </view>
    <view class="opponent-cards">
      <view wx:for="{{opponent.cards}}" wx:key="index" class="card-back">
        <text class="card-back-emoji">â¤ï¸</text>
      </view>
    </view>
  </view>

  <!-- ä¸­å¤®ç‰Œæ¡Œ -->
  <view class="center-table">
    <view class="table-cards">
      <view wx:for="{{centerCards}}" wx:key="id" 
            class="game-card {{item.selected ? 'selected' : ''}}"
            data-index="{{index}}"
            bindtap="selectCard">
        <text class="card-value">{{item.value}}</text>
      </view>
    </view>
    
    <!-- æ¸¸æˆçŠ¶æ€æç¤º -->
    <view class="game-status" wx:if="{{statusMessage}}">
      <text class="status-text">{{statusMessage}}</text>
    </view>

    <!-- æŠ¢ç­”æŒ‰é’® -->
    <button wx:if="{{gameState === 'PLAYING' && !isSolving}}" 
            class="btn btn-primary claim-button pulse"
            bindtap="claimSolution">
      æˆ‘çŸ¥é“äº†! ğŸ’¡
    </button>

    <!-- è§£ç­”ç•Œé¢ -->
    <view wx:if="{{gameState === 'SOLVING' && isSolving}}" class="solution-builder">
      <view class="solution-steps">
        <view wx:for="{{solutionSteps}}" wx:key="index" class="solution-step fade-in">
          <text class="step-text">{{item.left}} {{item.operator}} {{item.right}} = {{item.result}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="operation-buttons">
        <button wx:for="{{['+', '-', 'Ã—', 'Ã·']}}" wx:key="*this"
                class="op-button"
                data-op="{{item}}"
                bindtap="selectOperator">
          {{item}}
        </button>
      </view>

      <!-- æäº¤å’Œå–æ¶ˆæŒ‰é’® -->
      <view class="action-buttons">
        <button class="btn btn-secondary" bindtap="cancelSolution">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="submitSolution">æäº¤ç­”æ¡ˆ</button>
      </view>
    </view>
  </view>

  <!-- è‡ªå·±çš„ç‰Œ -->
  <view class="player-section">
    <view class="player-cards">
      <view wx:for="{{playerCards}}" wx:key="id" class="game-card player-card">
        <text class="card-value">{{item.value}}</text>
      </view>
    </view>
    <view class="player-info">
      <text class="player-name">{{player.name || 'æˆ‘'}}</text>
      <view class="card-count">
        <text class="card-emoji">â¤ï¸</text>
        <text class="card-number">{{player.cardCount || 10}}</text>
      </view>
    </view>
  </view>

  <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
  <view wx:if="{{gameState === 'GAME_OVER'}}" class="game-over-overlay">
    <view class="game-over-card card">
      <text class="game-over-title">{{isWinner ? 'ğŸ‰ èƒœåˆ©!' : 'ğŸ˜¢ å¤±è´¥'}}</text>
      <text class="game-over-message">{{gameOverMessage}}</text>
      <view class="game-over-buttons">
        <button class="btn btn-primary" bindtap="requestRematch">å†æ¥ä¸€å±€</button>
        <button class="btn btn-secondary" bindtap="backToLobby">è¿”å›å¤§å…</button>
      </view>
    </view>
  </view>
</view>